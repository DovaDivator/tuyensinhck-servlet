import{r as m,j as t,s as A,h as me,d as se,a as Q,f as ue,e as oe,u as ie,b as re,c as de,H as ge}from"./index-qv2f6qUe.js";import{I as pe}from"./IndexBackground-BPIzxaN0.js";import{L as ce}from"./ListTable-mOjGfO5l.js";import{a as $,I as W}from"./InputField-Bs1ecEZR.js";import{I as R}from"./formatTimestamp-CaO187jo.js";import{C as Y}from"./ChoiceGroup-RSvVkFzd.js";import{B as v}from"./MainWarpper-Dh6EhIZe.js";import{P as fe}from"./Pagination-DIHzGXT1.js";import{D as P}from"./Dropdown-CyRi64eP.js";import{a as le}from"./alertForm-CVZZy8_w.js";import{a as Z}from"./alertBasic-BlckFawB.js";import"./ManagerUserPage-l0sNRNKZ.js";import{f as ye}from"./FetchKyThi-BD1j5qFx.js";import{D as q,a as H}from"./DatetimePicker-OnKih5tk.js";import{C as ee}from"./Card-C1yEMw4c.js";import{p as _}from"./parseFlexibleDate-Ccvibv4l.js";import{f as xe}from"./FetchVietnamTime-DpsSIMj-.js";import{c as te}from"./checkValidSubmitUtils-Bid7X6wl.js";import"./Header-BwPZUt6b.js";import"./LogoGuest-DAj0gcma.js";import"./useScrollbar-BJwbBr6P.js";/* empty css                   */import"./ChoiceValids-DDD_5smu.js";const be=async({token:o="",type:l="tai-khoan",search:e="",params:n={},page:s=1})=>{const a=new URLSearchParams;if(a.append("type",l),e&&a.append("search",e),a.append("page",String(s)),n)for(const h in n){const r=n[h];Array.isArray(r)?r.forEach(p=>{p!==void 0&&a.append(h,p)}):typeof r=="string"&&a.append(h,r)}try{const h=await fetch(`/api/fetch-users?${a.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},credentials:"include"}),r=await h.text(),p=await JSON.parse(r);if(!h.ok){const u={status:h.status,message:p.message};throw console.error(u),u}return await p}catch(h){throw h instanceof TypeError&&h.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:h}},Se=async({token:o="",type:l="tai-khoan",search:e="",params:n={},page:s=1})=>{const a=new URLSearchParams;if(a.append("type",l),e&&a.append("search",e),a.append("page",String(s)),n)for(const h in n){const r=n[h];Array.isArray(r)?r.forEach(p=>{p!==void 0&&a.append(h,p)}):typeof r=="string"&&a.append(h,r)}try{const h=await fetch(`/api/users-manager-pagination?${a.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},credentials:"include"}),r=await h.text(),p=await JSON.parse(r);if(!h.ok){const u={status:h.status,message:p.message};throw console.error(u),u}return await p}catch(h){throw h instanceof TypeError&&h.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:h}},G=async({token:o="",type:l=""})=>{const e=new URLSearchParams;e.append("type",l);try{const n=await fetch(`/api/users-dropdown?${e.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},credentials:"include"}),s=await n.text(),a=await JSON.parse(s);if(!n.ok){const h={status:n.status,message:a.message};throw console.error(h),h}return await a}catch(n){throw n instanceof TypeError&&n.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:n}},he=async(o,l)=>{try{const e=await fetch("/api/users-edit?type=freeze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(l),credentials:"include"}),n=await e.text(),s=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:s.message};throw console.error(a),a}return s}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},ke=async(o,l)=>{try{const e=await fetch("/api/users-edit?type=delete-stu",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(l),credentials:"include"}),n=await e.text(),s=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:s.message};throw console.error(a),a}return s}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},we=async(o,l)=>{try{const e=await fetch("/api/users-edit?type=update-gv-mon",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(l),credentials:"include"}),n=await e.text(),s=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:s.message};throw console.error(a),a}return s}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},Te=async(o,l)=>{try{const e=await fetch("/api/add?type=teacher",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(l),credentials:"include"}),n=await e.text(),s=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:s.message};throw console.error(a),a}return s}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},ve=({setFormData:o,listMon:l=[],defaultValue:e=""})=>{const[n,s]=m.useState({mon:e});return m.useEffect(()=>{o?o({mon:String(n.mon)}):console.error("Không có setFormData")},[n,o]),t.jsxs("div",{style:{height:"270px"},children:[t.jsx("label",{style:{marginBottom:"6px",display:"block"},children:"Chọn môn học quản lý:"}),t.jsx(P,{name:"mon",id:"mon",label:"môn học",value:String(n.mon),setFormData:s,choices:l,allowDefault:!0})]})},Ee=({setFormData:o,listMon:l=[]})=>{const[e,n]=m.useState({name:"",mon:"",email:"",phone:""});return m.useEffect(()=>{o({name:String(e.name||""),mon:String(e.mon||""),email:String(e.email||""),phone:String(e.phone||"")})},[e,o]),t.jsxs("div",{style:{height:"270px",maxWidth:"400px",margin:"auto"},className:"basic-gap",children:[t.jsx("h3",{style:{marginBottom:"6px",display:"block"},children:"Thêm giáo viên:"}),t.jsx($,{name:"name",id:"name",value:e.name,formData:e,setFormData:n,placeholder:"Tên giáo viên"}),t.jsx(P,{name:"mon",id:"mon",label:"môn đảm nhiệm",value:String(e.mon),setFormData:n,choices:l,allowDefault:!0}),t.jsx($,{name:"email",id:"email",value:e.email,formData:e,setFormData:n,placeholder:"Email"}),t.jsx($,{name:"phone",id:"phone",value:e.phone,formData:e,setFormData:n,placeholder:"Số điện thoại (không bắt buộc)"})]})},je=({token:o,data:l,setData:e,setIsEdit:n})=>{e(l.map(s=>{const{link:a,...h}=s;return{...h,del:t.jsx(v,{type:"button",icon:"fa-solid fa-trash",className:"btn-cancel",title:"Loại bỏ thí sinh",onClick:async()=>{try{const r=await ke(o,{id:s.stu_id});console.log(r),A("success","Thông báo","Cập nhật thành công!"),e(p=>p.filter(u=>u.id!==s.id))}catch(r){console.error("Xóa thất bại",r)}}})}}))},Ce=({data:o,setData:l})=>{l(o.map(e=>{const{del:n,...s}=e;return{...s,link:"https://translate.google.com/?hl=vi&sl=ru&tl=vi&op=translate"}}))},Ne=({token:o,data:l,setData:e,setIsEdit:n})=>{e(l.map(s=>{const{link:a,...h}=s;return{...h,freeze:t.jsx(v,{type:"button",icon:`fa-solid ${s.isFreeze==="Đang hoạt động"?"fa-lock":"fa-unlock"}`,className:s.isFreeze==="Đang hoạt động"?"btn-cancel":"btn-accept",title:s.isFreeze==="Đang hoạt động"?"Đình chỉ nguời dùng":"Kích hoạt trở lại",onClick:async()=>{try{const r=await he(o,{id:s.id});console.log(r),e(p=>p.map(u=>u.id===s.id?{...u,isFreeze:u.isFreeze==="Đang hoạt động"?"Bị đình chỉ":"Đang hoạt động"}:u)),A("success","Thông báo","Cập nhật thành công!"),n(!1),setTimeout(()=>n(!0),0)}catch(r){console.error("Freeze thất bại",r)}}}),removeCd:t.jsx(v,{type:"button",icon:"fa-solid fa-eye",className:"btn-confirm",disabled:s.isxacthuc==="Chưa xác thực",title:"Xem chi tiết",onClick:()=>{window.open(`/quan-ly-cccd?id=${s.id}`,"_blank")}})}}))},De=({data:o,setData:l})=>{l(o.map(e=>{const{removeCd:n,freeze:s,...a}=e;return{...a,link:"https://translate.google.com/?hl=vi&sl=ru&tl=vi&op=translate"}}))},Fe=({token:o,data:l,setData:e,setIsEdit:n,listMon:s})=>{e(l.map(a=>{const{link:h,...r}=a;return{...r,freeze:t.jsx(v,{type:"button",icon:`fa-solid ${a.isFreeze==="Đang hoạt động"?"fa-lock":"fa-unlock"}`,className:a.isFreeze==="Đang hoạt động"?"btn-cancel":"btn-accept",title:a.isFreeze==="Đang hoạt động"?"Đình chỉ nguời dùng":"Kích hoạt trở lại",onClick:async()=>{try{const p=await he(o,{id:a.id});console.log(p),e(u=>u.map(f=>f.id===a.id?{...f,isFreeze:f.isFreeze==="Đang hoạt động"?"Bị đình chỉ":"Đang hoạt động"}:f)),A("success","Thông báo","Cập nhật thành công!"),n(!1),setTimeout(()=>n(!0),0)}catch(p){console.error("Freeze thất bại",p)}}}),change:t.jsx(v,{type:"button",icon:"fa-solid fa-pen",title:"Cập nhật môn quản lý",onClick:async()=>{const p=s.find(g=>g.label===a.mon_ql),u=(p==null?void 0:p.value)||"",f=await le(ve,{listMon:s,defaultValue:u});if(!(!f.isConfirmed||f.value.mon===u))try{const g=await we(o,{id:a.id,mon:f.value.mon});console.log(g),e(d=>d.map(b=>{var x;return b.id===a.id?{...b,mon_ql:(x=s.find(k=>k.value===f.value.mon))==null?void 0:x.label}:b})),A("success","Thông báo","Cập nhật thành công!"),n(!1),setTimeout(()=>n(!0),0)}catch(g){console.error("Freeze thất bại",g)}}})}}))},ze=({data:o,setData:l})=>{l(o.map(e=>{const{change:n,freeze:s,...a}=e;return{...a,link:"https://translate.google.com/?hl=vi&sl=ru&tl=vi&op=translate"}}))},Pe=async(o,l)=>{const e={name:new W({required:!0}),email:new W({required:!0,matchType:["email"]})},n=await le(Ee,{listMon:l},e);if(!n.isConfirmed)return;const s=await me("123456a@");try{const a=await Te(o,{name:n.value.name,mon:n.value.mon,email:n.value.email,phone:n.value.phone,password:s});Z({icon:"success",title:"Thành công",message:"Đã thêm giáo viên vào dữ liệu",timer:5e3}).then(()=>{window.location.reload()})}catch(a){Z({title:"Lỗi",message:"Thêm giáo viên không thành công!"}),console.error("Thêm thất bại",a)}},T=["giao-vien","thi-sinh","tai-khoan"],ae={"thi-sinh":{exam_id:"SBD",stu_id:"Mã TS",name:"Họ tên",he:"Cấp bậc",khoa_thi:"Khóa",phong1:"Phòng thi 1",phong2:"Phòng thi 2",mon_tc:"Môn tự chọn",phong3:"Phòng thi 3",mon_nn:"Ngoại ngữ",phong4:"Phòng thi 4"},"tai-khoan":{id:"Mã TS",name:"Họ tên",created_at:"Thời gian đăng ký",isFreeze:"Trạng thái",isxacthuc:"Đã xác thực"},"giao-vien":{id:"Mã GV",name:"Họ tên",mon_ql:"Môn quản lý",isFreeze:"Trạng thái"}},Ae={"thi-sinh":{del:"Xóa"},"tai-khoan":{removeCd:"Loại bỏ CCCD",freeze:"Đình chỉ"},"giao-vien":{change:"Chỉnh sửa môn",freeze:"Đình chỉ"}},Oe=({className:o="",name:l=""})=>{const{token:e}=Q(),s=ue().pathname,a=s.split("/"),[h]=oe(),r=parseInt(h.get("page")||"1"),p=(h.get("search")||"").slice(0,70),u={},[f,g]=m.useState(!1);if(h.forEach((c,i)=>{i!=="page"&&i!=="search"&&(u[i]=c)}),a.length===2)return ne(`path không hợp lệ ${s}`);if(!T.includes(a[2]))return ne(`type path không xác định ${a[2]}`);const[d,b]=m.useState(()=>{const c={search:p||""};switch(a[2]){case T[1]:c.he=u.he??"",c.khoa=u.khoa??"0",c.tuChon=u.tuChon??"",c.ngoaiNgu=u.ngoaiNgu??"";break;case T[2]:c.xacThuc=u.xacThuc??"",c.hoatDong=u.hoatDong??"";break;case T[0]:c.mon=u.mon??"",c.hoatDong=u.hoatDong??"";break}return c}),[x,k]=m.useState([]),O=[{value:"1",label:"Đại học"},{value:"2",label:"Cao đẳng"},{value:"3",label:"Liên thông"}],E={filterStatus:new Y([{value:"true",label:"Đã xác thực"},{value:"false",label:"Chưa xác thực"}]),filterFreeze:new Y([{value:"true",label:"Đang hoạt động"},{value:"false",label:"Bị đình chỉ"}])},[K,j]=m.useState(""),{setIsLoading:C}=ie();m.useEffect(()=>{(async()=>{C(!0),j("");let i={};switch(a[2]){case T[1]:i={he:d.he,khoa:d.khoa,tuChon:d.tuChon,ngoaiNgu:d.ngoaiNgu};break;case T[2]:i={xacThuc:d.xacThuc,hoatDong:d.hoatDong};break;case T[0]:i={mon:d.mon,hoatDong:d.hoatDong};break}try{const y=await be({token:e,type:a[2],search:String(d.search),params:i,page:r});console.log(y),k(y.data.map(w=>({...w,isFreeze:w.isFreeze===!0?"Tạm đình chỉ":"Đang hoạt động",isxacthuc:w.isxacthuc===0?"Chờ phê duyệt":w.isxacthuc===1?"Đã xác thực":w.isxacthuc===-1?"Đang từ chối":"Chưa xác thực"})))}catch(y){console.error(y)}finally{C(!1)}})()},[r]);const[N,D]=m.useState(1);m.useEffect(()=>{(async()=>{try{const i=await Se({token:e,type:a[2],search:String(d.search),params:{xacThuc:d.xacThuc,hoatDong:d.hoatDong},page:r});D(i.data.totalPage)}catch(i){j("Lỗi khi tải dữ liệu"),console.error(i)}finally{C(!1)}})()},[r]);const[F,U]=m.useState([]);m.useEffect(()=>{const c=async()=>{try{const i=await G({token:e,type:"tu-chon"});U(i.data)}catch(i){j("Lỗi khi tải dữ liệu"),console.error(i)}console.log(F)};d.tuChon!==void 0&&c()},[d.tuChon!==void 0]);const[V,I]=m.useState([]);m.useEffect(()=>{const c=async()=>{try{const i=await G({token:e,type:"ngoai-ngu"});I(i.data)}catch(i){j("Lỗi khi tải dữ liệu"),console.error(i)}};d.tuChon!==void 0&&c()},[d.tuChon!==void 0]);const[L,S]=m.useState([]);return m.useEffect(()=>{const c=async()=>{try{const i=await G({token:e,type:"mon-hoc"});S(i.data)}catch(i){console.error(i)}};d.mon!==void 0&&c()},[d.mon!==void 0]),m.useEffect(()=>{switch(a[2]){case T[1]:f?je({token:e,data:x,setData:k,setIsEdit:g}):Ce({data:x,setData:k});break;case T[2]:f?Ne({token:e,data:x,setData:k,setIsEdit:g}):De({data:x,setData:k});break;case T[0]:f?Fe({token:e,data:x,setData:k,setIsEdit:g,listMon:L}):ze({data:x,setData:k});break}},[f]),t.jsxs("section",{className:`manager-user-list ${o}`,children:[t.jsxs("h2",{children:["Danh sách ",l]}),t.jsxs("div",{className:"manager-user-list__filter",children:[t.jsxs("form",{id:"filter-user-form",noValidate:!0,children:[t.jsx($,{name:"search",id:"search",placeholder:"Tìm kiếm",value:d.search,maxLength:70,formData:d,setFormData:b}),a[2]===T[2]&&t.jsxs(t.Fragment,{children:[t.jsx(R,{name:"xacThuc",id:"xacThuc",type:"radio",label:"Trạng thái xác thực CCCD",choices:E.filterStatus.getOptions(),value:d.xacThuc,setFormData:b,columns:2}),t.jsx(R,{name:"hoatDong",id:"hoatDong",type:"radio",label:"Tình trạng tài khoản",choices:E.filterFreeze.getOptions(),value:d.hoatDong,setFormData:b,columns:2})]}),a[2]===T[0]&&t.jsxs(t.Fragment,{children:[t.jsx(R,{name:"hoatDong",id:"hoatDong",type:"radio",label:"Tình trạng tài khoản",choices:E.filterFreeze.getOptions(),value:d.hoatDong,setFormData:b,columns:2}),t.jsx(P,{name:"mon",id:"mon",label:"Môn quản lý",choices:L,value:String(d.mon),setFormData:b,allowDefault:!0})]}),a[2]===T[1]&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"horizontal-field",children:[t.jsx(P,{name:"he",id:"he",label:"Hệ đào tạo",choices:O,value:String(d.he),setFormData:b}),t.jsx($,{name:"khoa",id:"khoa",type:"number",value:d.khoa,formData:d,setFormData:b,placeholder:"Khóa thi"})]}),t.jsxs("div",{className:"horizontal-field",children:[t.jsx(P,{name:"tuChon",id:"tuChon",label:"Môn tự chọn",choices:F,value:String(d.tuChon),setFormData:b,allowDefault:!0}),t.jsx(P,{name:"ngoaiNgu",id:"ngoaiNgu",label:"Môn ngoại ngữ",choices:V,value:String(d.ngoaiNgu),setFormData:b,allowDefault:!0})]})]}),t.jsxs("div",{className:"button-container",children:[t.jsx(v,{type:"submit",text:"Tìm kiếm",className:"btn-confirm"}),t.jsx(v,{type:"button",text:"Đặt lại",className:"btn-cancel",onClick:()=>{b({search:"",xacThuc:[],hoatDong:[],kyThi:""})}}),t.jsx(v,{type:"button",text:f?"Chế độ xem":"Chỉnh sửa",onClick:()=>{g(!f)}}),a[2]===T[0]&&t.jsx(v,{type:"button",title:"Thêm giáo viên",icon:"fa-solid fa-plus",onClick:()=>{Pe(e,L)},className:"btn-confirm"})]})]}),t.jsx("hr",{})]}),t.jsx(ce,{struct:x,headers:f?{...ae[a[2]],...Ae[a[2]]}:ae[a[2]],error:K}),t.jsx(fe,{curNum:r,listLength:N})]})},X=se.memo(Oe),ne=o=>(console.log(o),t.jsx(t.Fragment,{})),Ke=async(o,l)=>{try{const e=await fetch("/api/open-ky-thi",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(l),credentials:"include"}),n=await e.text(),s=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:s.message};throw console.error(a),a}return s}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},Le=async(o,l)=>{try{const e=await fetch("/api/open-ngay-thi",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(l),credentials:"include"}),n=await e.text(),s=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:s.message};throw console.error(a),a}return s}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},Je={loaiThiLabel:"Cấp bậc",khoa:"Khóa thi",timeStart:"Thời gian mở",timeEnd:"Thời gian đóng",dateExam:"Ngày tổ chức",status:"Tình trạng",adding:"Bổ sung?"},M=[{value:"dh",label:"Đại học"},{value:"cd",label:"Cao đẳng"},{value:"lt",label:"Liên thông"}],Be=[t.jsx("span",{className:"unknown",children:"Không xác định"}),t.jsx("span",{className:"accept",children:"Đã qua kỳ thi"}),t.jsx("span",{className:"warning",children:"Trong kỳ thi"}),t.jsx("span",{className:"unknown",children:"Chờ thi"}),t.jsx("span",{className:"denied",children:"Đã đóng"}),t.jsx("span",{className:"accept",children:"Đang mở"}),t.jsx("span",{className:"unknown",children:"Chưa mở"})],_e=(()=>{const o=new Date;return o.setDate(o.getDate()+1),o.setHours(7,0,0,0),o})(),Me=({className:o=""})=>{const{token:l}=Q(),{isLoading:e,setIsLoading:n}=ie(),s=re(),[a,h]=m.useState(""),[r,p]=m.useState({type:""}),[u,f]=m.useState([]),[g,d]=m.useState(0),[b]=oe();m.useEffect(()=>{const S=b.get("type")||"";p({type:S})},[b]);const[x,k]=m.useState({timeStart:"",timeEnd:"",adding:""}),[O,E]=m.useState({dateExam:""}),K=m.useRef(null),j=m.useRef(null),[C,N]=m.useState({timeStart:"",timeEnd:"",adding:"",dateExam:""}),[D,F]=m.useState({timeStart:new q({required:!0,cons:{min:{value:_e}}}),timeEnd:new q({required:!0,cons:{min:{value:"timeStart",dist:{day:1}}}})});m.useEffect(()=>{const S=async i=>{if(!("timeStart"in i&&"timeEnd"in i))return 0;const y=await xe();if("dateExam"in i){const B=_("07:00 "+i.dateExam).getTime()-y.getTime();if(B<-1296e5)return 1;if(B<864e5)return 2;if(B<6048e5)return 3}return y.getTime()-_(String(i.timeEnd)).getTime()>0?4:y.getTime()-_(String(i.timeStart)).getTime()>0?5:6};(async()=>{n(!0),h("");try{const i=await ye();console.log(i);const y=await Promise.all(i.data.map(async w=>{const z=M.find(B=>B.value===w.loaiThi),J=await S(w);return{...w,loaiThiLabel:(z==null?void 0:z.label)||"Không xác định",statusEffect:J,status:Be[J]}}));f(y)}catch(i){console.error(i)}finally{n(!1)}})()},[r.type]),m.useEffect(()=>{if(u.length>0&&r.type!==""&&M.find(c=>c.value===r.type)){const c=u.find(y=>y.loaiThi===r.type),i={timeStart:c.timeStart?c.timeStart:"",timeEnd:c.timeEnd?c.timeEnd:"",adding:c.adding};if(c.dateExam&&F(y=>({...y,timeEnd:new q({required:!0,cons:{min:{value:"timeStart",dist:{day:1}},max:{value:_("07:00 "+c.dateExam),dist:{day:6}}}})})),[4,5,6].includes(c.statusEffect)){const y=_(c.timeEnd),w=y.getTime()-new Date().getTime();F(J=>({...J,dateExam:new q({required:!0,cons:{min:{value:w>0?y:new Date,dist:{day:7}}}})}));const z={dateExam:c.dateExam?c.dateExam:""};E(z),j.current=z}k(i),K.current=i,d(c.statusEffect??0)}},[r.type,u]),m.useEffect(()=>{const S=M.find(c=>c.value===r.type);S&&b.get("type")!==S.value&&s(`/quan-ly/ky-thi?type=${S.value}`)},[r.type]),m.useEffect(()=>{g<=1||(g===5&&F(S=>{const{timeStart:c,...i}=S;return i}),g<=3&&F({}))},[g]);const U=()=>{K.current?k(K.current):(k({timeStart:"",timeEnd:"",adding:""}),console.warn("Dữ liệu mặc định chưa được khởi tạo"))},V=()=>{j.current?E(j.current):(E({dateExam:""}),console.warn("Dữ liệu mặc định chưa được khởi tạo"))},I=async()=>{n(!0);const{dateExam:S,...c}=D,i=te(x,c,N);if(!i){A("error","","Vui lòng kiểm tra lại thông tin đăng nhập!"),n(!1);return}console.log(i);try{const y=x.adding instanceof Array?x.adding[0]:x.adding,w=await Ke(l,{...x,adding:y,type:r.type});console.log(w)}catch(y){console.error(y)}n(!1)},L=async()=>{n(!0);const{dateExam:S}=D,c=te(O,{dateExam:S},N);if(!c){A("error","","Vui lòng kiểm tra lại thông tin đăng nhập!"),n(!1);return}console.log(c);try{const i=await Le(l,{...O,type:r.type});console.log(i)}catch(i){console.error(i)}n(!1)};return t.jsxs("section",{className:`manager-exam ${o}`,children:[t.jsx("h2",{children:"Quản lý kỳ thi"}),t.jsx(ce,{struct:u,headers:Je,error:a}),t.jsx("h4",{children:"Chỉnh sửa nhanh:"}),t.jsx(P,{name:"type",id:"type",choices:M,value:r.type,setFormData:p,label:"Kỳ thi"}),M.some(S=>S.value===r.type)&&t.jsxs("div",{className:"form-container-ky-thi",children:[t.jsxs(ee,{className:"form-ky-thi",children:[t.jsx("b",{children:"Mở đăng ký"}),t.jsxs("form",{children:[t.jsx(H,{type:"datetime",name:"timeStart",id:"timeStart",value:String(x.timeStart),setFormData:k,placeholder:"Thời gian mở",disabled:[2,3,5].includes(g),errors:C,setErrors:N,valids:D.timeStart}),t.jsx(H,{type:"datetime",name:"timeEnd",id:"timeEnd",value:String(x.timeEnd),setFormData:k,placeholder:"Thời gian đóng",disabled:[2,3].includes(g),errors:C,setErrors:N,valids:D.timeEnd}),t.jsx(R,{name:"adding",id:"adding",choices:[{value:"true",label:"Bổ sung thí sinh?"}],value:x.adding,setFormData:k,disabled:g!==4})]}),t.jsxs("div",{className:"button-form",children:[t.jsx(v,{type:"button",className:"btn-confirm",onClick:I,text:"Cập nhật!",disabled:e||[2,3].includes(g)}),t.jsx(v,{type:"button",className:"btn-cancel",onClick:U,text:"Khôi phục",disabled:e})]})]}),t.jsxs(ee,{className:"form-ky-thi",children:[t.jsx("b",{children:"Mở kỳ thi"}),[0,1].includes(g)&&t.jsx("p",{className:"error-message",children:"Bạn cần phải mở đăng ký trước!"}),[2,3].includes(g)&&t.jsx("p",{className:"error-message",children:"Kỳ thi đã chuẩn bị, bạn không thể thay đổi kế hoạch"}),[4,5,6].includes(g)&&t.jsxs(t.Fragment,{children:[t.jsx("form",{children:t.jsx(H,{type:"date",name:"dateExam",id:"dateExam",value:String(O.dateExam),setFormData:E,placeholder:"Thời gian tổ chức",disabled:[0,1,2,3].includes(g),errors:C,setErrors:N,valids:D.dateExam})}),t.jsxs("div",{className:"button-form",children:[t.jsx(v,{type:"button",className:"btn-confirm",onClick:L,text:"Cập nhật!",disabled:e||[2,3].includes(g)}),t.jsx(v,{type:"button",className:"btn-cancel",onClick:V,text:"Khôi phục",disabled:e})]})]})]})]})]})},$e=se.memo(Me),mt=()=>{const o=re(),{type:l}=de(),[e,n]=m.useState(t.jsx(t.Fragment,{})),[s,a]=m.useState(""),{user:h}=Q();h.isAdmin()||o("/");const r=["giao-vien","thi-sinh","tai-khoan","ky-thi"];return m.useEffect(()=>{(({type:u=""})=>{let f="",g=t.jsx(t.Fragment,{});switch(u){case r[0]:f="giáo viên",g=t.jsx(X,{name:f});break;case r[1]:f="thí sinh",g=t.jsx(X,{name:f});break;case r[2]:f="tài khoản",g=t.jsx(X,{name:f});break;case r[3]:f="kỳ thi",g=t.jsx($e,{});break;default:console.error("lỗi url "+u),o("/");return}a(f),n(g)})({type:l})},[]),t.jsxs("div",{children:[t.jsx(ge,{children:t.jsxs("title",{children:["Quản lý ",s," - Web tuyển sinh"]})}),t.jsx(pe,{children:e})]})};export{mt as default};
