import{b as v,r as c,j as t,u as w,e as T,a as D,H as k}from"./index-qv2f6qUe.js";import{I as S}from"./IndexBackground-BPIzxaN0.js";import{a as L,i as M,b as A}from"./StudentExam-Dj7XA_J1.js";import{B as f}from"./MainWarpper-Dh6EhIZe.js";import{a as q}from"./FetchKyThi-BD1j5qFx.js";import{D as p}from"./Dropdown-CyRi64eP.js";import{c as B}from"./checkValidSubmitUtils-Bid7X6wl.js";import{g as H}from"./GetMonHoc-B5pGtDKO.js";import{C as G}from"./Card-C1yEMw4c.js";import"./Header-BwPZUt6b.js";import"./LogoGuest-DAj0gcma.js";import"./ChoiceValids-DDD_5smu.js";const N=({caseDeny:s})=>{const n=v(),e=["start","loop"],[a,o]=c.useState(e[0]);c.useEffect(()=>{const r=()=>{setTimeout(()=>{o(e[1]),setTimeout(()=>{o(""),setTimeout(r,5e3)},1250)},5e3)};return o(e[0]),r(),()=>{}},[]);const i=["Bạn chưa xác thực thông tin!","Thông tin xác thực của bạn bị từ chối!"];return[0,1].includes(s)?t.jsx("div",{className:"container text-center mt-5",children:t.jsxs("div",{className:"alert alert-warning",children:[t.jsx("h2",{children:i[s]}),t.jsx("span",{children:"Vui lòng vào đây để xác thực thông tin..."}),t.jsx(f,{text:"Xác thực!",className:a,onClick:()=>n("/info/xac-thuc-cccd")})]})}):t.jsx(t.Fragment,{})},K=()=>t.jsx("div",{className:"container text-center mt-5",children:t.jsxs("div",{className:"alert alert-warning",children:[t.jsx("h2",{children:"THÔNG BÁO!"}),t.jsx("span",{children:"Thông tin của bạn vẫn đang đợi phê duyệt, vui lòng quay lại sau..."})]})}),F=()=>t.jsx("div",{className:"container text-center mt-5",children:t.jsxs("div",{className:"alert alert-warning",children:[t.jsx("h2",{children:"CẢM ƠN BẠN ĐÃ ĐĂNG KÝ KỲ THI!"}),t.jsxs("span",{children:["Xem thông tin đăng ký của bạn ",t.jsx("a",{href:"/info/tra-cuu-ky-thi",children:"tại đây"})]})]})}),I=()=>t.jsx("div",{className:"container text-center mt-5",children:t.jsxs("div",{className:"alert alert-warning",children:[t.jsx("h2",{children:"Tiếc thật!"}),t.jsx("span",{children:"Hiện tại chưa có kỳ thi nào đang mở, vui lòng quay lại sau..."})]})}),P=(s,n,e=new g)=>e.required&&e.required&&n.trim()===""?{[s]:"Trường này là bắt buộc."}:{[s]:""};class g{constructor({required:n=!1}={}){this.required=n}validate(n,e){return P(n,e,this)}}const R=({token:s=""})=>{const[n,e]=c.useState(t.jsx(t.Fragment,{}));return c.useEffect(()=>{s&&(async()=>{try{if(!(await L(s)).data){e(t.jsx(F,{}));return}const i=await q();if(!i.data||i.data.length===0){e(t.jsx(I,{}));return}e(t.jsx(_,{listDK:i.data,token:s})),console.log(i)}catch(o){console.error(o)}})()},[s]),n},X=[{value:"dh",label:"Đại học"},{value:"cd",label:"Cao đẳng"},{value:"lt",label:"Liên thông"}],_=({listDK:s,token:n})=>{const{isLoading:e,setIsLoading:a}=w(),[o]=T(),i=o.get("type")||"",[r,C]=c.useState({monTC:[],monNN:[]}),E=X.filter(m=>s.includes(m.value)),[d,h]=c.useState({typeExam:i,monTC:"",monNN:""}),[j,u]=c.useState({typeExam:i,monTC:"",monNN:""}),x={typeExam:new g({required:!0}),monTC:new g({required:!0}),monNN:new g({required:!0})};c.useEffect(()=>{a(!0),(async()=>{try{const l=await H();if(console.log(l),!l.data)throw new Error("Không có dữ liệu");C(l.data)}catch(l){console.error(l)}})(),a(!1)},[]);const b=()=>{h({typeExam:i,monTC:"",monNN:""})},y=async()=>{a(!0);const m=B(d,x,u);if(console.log(m),!m){a(!1);return}try{const l=await M(n,d);console.log(l)}catch(l){console.error(l)}a(!1)};return t.jsx("section",{children:t.jsxs(G,{className:"exam-register-container",children:[t.jsx("h2",{children:"Đăng ký kỳ thi"}),t.jsxs("form",{children:[t.jsxs("div",{className:"label-dropdown",children:[t.jsx("span",{children:"Chọn kỳ thi đang diễn ra:"}),t.jsx(p,{name:"typeExam",id:"typeExam",choices:Object.values(E),value:String(d.typeExam),setFormData:h,errors:j,setErrors:u,valid:x.typeExam})]}),t.jsxs("div",{className:"label-dropdown",children:[t.jsx("span",{children:"Môn tự chọn:"}),t.jsx(p,{name:"monTC",id:"monTC",choices:r.monTC,value:String(d.monTC),setFormData:h,errors:j,setErrors:u,valid:x.monTC})]}),t.jsxs("div",{className:"label-dropdown",children:[t.jsx("span",{children:"Môn ngoại ngữ:"}),t.jsx(p,{name:"monNN",id:"monNN",choices:r.monNN,value:String(d.monNN),setFormData:h,label:"môn ngoại ngữ",errors:j,setErrors:u,valid:x.monNN})]})]}),t.jsxs("div",{className:"button-form",children:[t.jsx(f,{type:"button",className:"btn-confirm",onClick:y,text:"Cập nhật!",disabled:e}),t.jsx(f,{type:"button",className:"btn-cancel",onClick:b,text:"Khôi phục",disabled:e})]})]})})},st=()=>{const{token:s,user:n}=D(),[e,a]=c.useState(t.jsx(t.Fragment,{})),o=v();return n.isStudent()||o("/"),c.useEffect(()=>{(async()=>{try{const r=await A(s);if(console.log(r),!r.success)throw new Error("Lỗi trả về dữ liệu");switch(r.data){case-3e3:a(t.jsx(N,{caseDeny:0}));break;case-1:a(t.jsx(N,{caseDeny:1}));break;case 0:a(t.jsx(K,{}));break;case 1:a(t.jsx(R,{token:s}));break;default:throw new Error("Mã không khớp "+r.data)}}catch(r){console.error(r)}})()},[]),t.jsxs("div",{children:[t.jsx(k,{children:t.jsx("title",{children:"Đăng ký thi - Web tuyển sinh"})}),t.jsx(S,{children:e})]})};export{st as default};
