import{d as A,a as v,u as R,e as P,r as d,j as r,b as q,H as K}from"./index-qv2f6qUe.js";import{I as V}from"./IndexBackground-BPIzxaN0.js";import{C as $,I as N,b as j,c as z}from"./base64ToFile-DY9lArFe.js";import{f as g}from"./formatTimestamp-CaO187jo.js";import{B as f}from"./MainWarpper-Dh6EhIZe.js";import{c as U}from"./checkValidSubmitUtils-Bid7X6wl.js";import{D as Y}from"./DatetimePicker-OnKih5tk.js";import{I as x}from"./InputField-Bs1ecEZR.js";import{C as L}from"./ChoiceValids-DDD_5smu.js";import"./ManagerUserPage-l0sNRNKZ.js";import"./Header-BwPZUt6b.js";import"./LogoGuest-DAj0gcma.js";import"./parseFlexibleDate-Ccvibv4l.js";/* empty css                   */const M=async(s,i)=>{try{const e=await fetch("/api/admin-cccd-mgr?action=accept",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(i),credentials:"include"}),n=await e.text(),o=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:o.message};throw console.error(a),a}return o}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},G=async(s,i)=>{try{const e=await fetch("/api/admin-cccd-mgr?action=select",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(i),credentials:"include"}),n=await e.text(),o=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:o.message};throw console.error(a),a}return o}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},H=async(s,i)=>{try{const e=await fetch("/api/admin-cccd-mgr?action=denied",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(i),credentials:"include"}),n=await e.text(),o=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:o.message};throw console.error(a),a}return o}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},Q=async(s,i)=>{try{const e=await fetch("/api/admin-cccd-mgr?action=delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(i),credentials:"include"}),n=await e.text(),o=await JSON.parse(n);if(!e.ok){const a={status:e.status,message:o.message};throw console.error(a),a}return o}catch(e){throw e instanceof TypeError&&e.message.includes("Failed to fetch")?{status:503,message:"Không thể kết nối đến máy chủ."}:e}},X=()=>{const{token:s,user:i}=v(),{isLoading:e,setIsLoading:n}=R(),[o]=P(),a=o.get("id")||"",p=d.useRef(null),y=d.useRef(null),[l,S]=d.useState(-1),[T,B]=d.useState(!1),[w,m]=d.useState({realName:"",numCccd:"",dateBirth:g(new Date(new Date().getFullYear()-18,0,1)),gender:"",address:""}),[C,h]=d.useState({front:void 0,back:void 0}),[F,b]=d.useState({realName:"",numCccd:"",dateBirth:"",gender:"",address:"",front:"",back:""}),k={front:new N({required:!0}),back:new N({required:!0}),dateBirth:new Y({required:!0,cons:{max:{value:new Date(new Date().getFullYear()-16,11,31)}}}),realName:new x({required:!0}),gender:new L({required:!0}),address:new x({required:!0}),numCccd:new x({required:!0,minlength:12,matchType:["cccd"]})};d.useEffect(()=>{s&&(async()=>{if(!a){B(!0);return}try{const t=await G(s,{id:a});console.log(t),S(t.data.confirm?parseInt(t.data.confirm):-1);const u={realName:t.data.realName||"",numCccd:t.data.numCccd||"",dateBirth:t.data.dateBirth?g(t.data.dateBirth):g(new Date(new Date().getFullYear()-18,0,1)),gender:t.data.gender||"",address:t.data.address||""},D={front:t.data.front===void 0?t.data.front:j("data:image/png;base64,"+t.data.front,"front.png","image/png"),back:t.data.back===void 0?t.data.back:j("data:image/png;base64,"+t.data.back,"front.png","image/png")};m(u),h(D),p.current=u,y.current=D}catch(t){console.error(t)}})()},[s]);const J=()=>{p.current&&y.current?(m(p.current),h(y.current)):(m({realName:"",numCccd:"",dateBirth:g(new Date(new Date().getFullYear()-18,0,1)),gender:"",address:""}),h({front:void 0,back:void 0}),console.warn("Dữ liệu mặc định chưa được khởi tạo"))},O=async()=>{n(!0);const c=U({...w,...C},k,b);if(console.log(c),!c){n(!1);return}const t=await z(C);try{const u=await M(s,{...w,...t,id:a});console.log(u)}catch(u){console.error(u)}n(!1)},I=async()=>{n(!0);try{const c=await Q(s,{id:a});console.log(c)}catch(c){console.error(c)}n(!1)},E=async()=>{n(!0);try{const c=await H(s,{id:a});console.log(c)}catch(c){console.error(c)}n(!1)};return T?r.jsx("div",{className:"container text-center mt-5",children:r.jsxs("div",{className:"alert alert-warning",role:"alert",children:[r.jsx("h4",{className:"alert-heading",children:"Không tìm thấy CCCD!"}),r.jsxs("p",{children:["Thông tin xác thực của id: ",a," này không tồn tại hoặc bị xóa trong hệ thống."]})]})}):r.jsxs("section",{className:"cccd-form-container",children:[r.jsx("h3",{children:"Xác thực CCCD: "}),l&&r.jsx("p",{className:"note"}),r.jsx($,{formData:w,setFormData:m,imgData:C,setImgData:h,errors:F,setErrors:b,isAdmin:!0,valids:k,status:l}),r.jsxs("div",{className:"button-form",children:[r.jsx(f,{type:"submit",className:"btn-confirm",onClick:O,text:"Phê duyệt!",disabled:l===1||e,title:l===1?"CCCD này đã được phê duyệt!":void 0}),r.jsx(f,{type:"button",className:"btn-cancel",onClick:E,text:"Không phê duyệt!",disabled:l===-1||e,title:l===-1?"CCCD này đang không phê duyệt!":void 0}),r.jsx(f,{type:"button",onClick:J,text:"Khôi phục",disabled:e}),r.jsx(f,{type:"button",className:"btn-cancel",onClick:I,text:"Loại bỏ!",disabled:e})]})]})},_=A.memo(X),me=()=>{const{user:s}=v(),i=q();return s.isAdmin()||i("/"),r.jsxs("div",{children:[r.jsx(K,{children:r.jsx("title",{children:"Quản lý dữ liệu CCCD"})}),r.jsx(V,{children:r.jsx(_,{})})]})};export{me as default};
